{"version":3,"file":"view.js","mappings":"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","sources":["webpack://ttm-forms/./blocks/ttm-form/src/view.js"],"sourcesContent":["/**\n * Use this file for JavaScript code that you want to run in the front-end\n * on posts/pages that contain this block.\n *\n * When this file is defined as the value of the `viewScript` property\n * in `block.json` it will be enqueued on the front end of the site.\n *\n * Example:\n *\n * ```js\n * {\n *   \"viewScript\": \"file:./view.js\"\n * }\n * ```\n *\n * If you're not making any changes to this file because your project doesn't need any\n * JavaScript running in the front-end, then you should delete this file and remove\n * the `viewScript` property from `block.json`.\n *\n * @see https://developer.wordpress.org/block-editor/reference-guides/block-api/block-metadata/#view-script\n */\n\n(function(){\n\n\tconst isExternalURL = (url) => new URL(url).origin !== location.origin;\n\n\tconst getParentByTagName = function(node, tagname) {\n\t\tvar parent;\n\t\tif (node === null || tagname === '') return;\n\t\tparent  = node.parentNode;\n\t\ttagname = tagname.toUpperCase();\n\n\t\twhile (parent.tagName !== \"HTML\") {\n\t\t\tif (parent.tagName === tagname) {\n\t\t\t\treturn parent;\n\t\t\t}\n\t\t\tparent = parent.parentNode;\n\t\t}\n\n\t\treturn parent;\n\t}\n\n\tString.prototype.hashCode = function() {\n\t\tvar hash = 0,\n\t\t  i, chr;\n\t\tif (this.length === 0) return hash;\n\t\tfor (i = 0; i < this.length; i++) {\n\t\t  chr = this.charCodeAt(i);\n\t\t  hash = ((hash << 5) - hash) + chr;\n\t\t  hash |= 0; // Convert to 32bit integer\n\t\t}\n\t\treturn hash;\n\t  }\n\n\tlet ids = document.querySelectorAll(\"[name='post_id']\");\n\tids.forEach(id => { id.setAttribute('value', ttm_post_id);});\n\n\tlet inputs = document.querySelectorAll(\".wp-block-ttm-form input, .wp-block-ttm-form textarea\");\n\n\tlet r = Math.floor(Math.random() * Number.MAX_SAFE_INTEGER);\n\n\tdocument.querySelectorAll(\".wp-block-ttm-form form\").forEach(form => {\n\t\tform.dataset.partial = r + \"-\" + form.innerHTML.hashCode();\n\n\t\tvar input = document.createElement(\"input\");\n\t\tinput.setAttribute(\"type\", \"hidden\");\n\t\tinput.setAttribute(\"name\", \"partial\");\n\t\tinput.setAttribute(\"value\", form.dataset.partial);\n\t\tform.appendChild(input);\n\t});\n\n\tinputs.forEach(input => {\n\t\tinput.addEventListener( 'input', function(e) {\n\t\t\tlet parentForm = getParentByTagName(this,'form');\n\t\t\tlet els = parentForm.elements;\n\n\t\t\tlet a = {\n\t\t\t\tpartial: r + \"-\" + parentForm.innerHTML.hashCode(),\n\t\t\t};\n\n\t\t\tfor (const el of els) {\n\t\t\t\tif (\n\t\t\t\t\tel.type == 'submit' ||\n\t\t\t\t\tel.name == 'g-recaptcha-response' ||\n\t\t\t\t\tel.name.startsWith('credit-card')\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ta[ el.name ] = el.value;\n\t\t\t}\n\t\t\tlet url = document.location.origin + '/wp-json/ttm-forms/v1/partial';\n\n\t\t\tconst credentials = isExternalURL(url) ? 'same-origin' : 'omit';\n\t\t\tfetch(url, {\n\t\t\t\tcache: 'no-store',\n\t\t\t\tcredentials: credentials,\n\t\t\t\tmethod: 'POST',\n\t\t\t\tredirect: 'follow',\n\t\t\t\theaders: {\n\t\t\t\t\t'Accept': 'application/json',\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify(a)\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tthrow new Error(`HTTP error! Status: ${response.status}`);\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t});\n\t\t});\n\t});\n})();\n"],"names":["isExternalURL","url","URL","origin","location","getParentByTagName","node","tagname","parent","parentNode","toUpperCase","tagName","String","prototype","hashCode","hash","i","chr","length","charCodeAt","ids","document","querySelectorAll","forEach","id","setAttribute","ttm_post_id","inputs","r","Math","floor","random","Number","MAX_SAFE_INTEGER","form","dataset","partial","innerHTML","input","createElement","appendChild","addEventListener","e","parentForm","els","elements","a","el","type","name","startsWith","value","credentials","fetch","cache","method","redirect","headers","body","JSON","stringify","then","response","ok","Error","status","json"],"sourceRoot":""}